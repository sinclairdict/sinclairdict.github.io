---
layout: post
title: 三层交换机简单配置-网关模式
comments: true
tags:
  - 交换机
date: 2021-11-21 20:26:07
---
通常情况下，当用一台IP地址为192.168.1.1的计算机去ping一台IP地址为192.168.2.1的计算机时，会出现“请求超时”的错误，即无法ping通，此时增加一台配置过的三层交换机，就能实现两台电脑互相访问的目的。
<!--more-->
那么在配置三层交换机前，需要了解一些信息。

### 1. 怎么理解IPv4地址？
IP是在同一个网络中，设备的唯一标识，起初是一串十进制数字，后来由点分为四组十进制数，再后来便于记忆，映射为域名，
由于计算机的二进制，即每个IP地址的由一个32位的二进制数来表示，以IP地址192.168.1.1为例：
192二进制表示为1100 0000；168二进制表示为1010 1000；1二进制表示为0000 0001
那么把上述IP地址转换成一个32位的二进制数就是1100 0000 1010 1000 0000 0001 0000 0001；
再将这个二进制数转换位十进制数，即3232235777，在网络中，这串数字等同于IP地址，但ping的时候容易被识别成设备名称。

### 2. 怎么理解子网掩码？
子网掩码必须配合IP地址使用，也是一组32位的二进制数，它用来区分网络范围，即同一网段，可分配多少个IP，
即以二进制表示子网掩码，从左数多少位为1，相应的二进制下IP地址前多少位必须保持一致，才能被视为同一网络范围，
比如常见的IP表示方法192.168.1.1/24，这个24指的就是子网掩码，24指32位的子网掩码，前24位为1，
即1111 1111 1111 1111 1111 1111 0000 0000，将其点分后转换为十进制，即255.255.255.0；
同时表明IP地址前三组数字相同时，即192.168.1.0-255的形式，才能被视为同一网络范围，
类似的子网掩码/16指的就是255.255.0.0，IP地址前两组数字相同，就可以被视为同一网络范围。

### 3. 怎么理解默认网关？
网关的作用是连接两个不同的网络范围，网关就是路由，当设备需要连接其他网络时，会将数据通过网关，传递到其他网络中。

### 4. 二层交换机和三层交换机的区别？
二层交换机通常用来在同一网络范围内转发数据，三层交换机相当于增加了路由功能的二层交换机，能在不同网络内转发数据。

### 5. 三层交换机配置-网关模式
大致了解上述信息，就可以开始简单的使用网关来配置三层交换机了。

以Cisco的[模拟软件](https://www.netacad.com/zh-hans/courses/packet-tracer)为例，建立一台名为L2-Switch1的交换机，连接两台IP地址为192.168.1.x网络的计算机(任意电口都可以)，建立一台名为L2-Switch2的交换机，连接两台IP地址为192.168.2.x网络的计算机(任意电口都可以)，将L2-Switch1交换机任意电口连接到L3-Switch交换机的1口，将L2-Switch2交换机任意电口连接到L3-Switch交换机的2口。
![](/assets/images/211121_1.jpg)
此时，相同网络内的计算机可以相互ping通，不同网络的计算机不能ping通。

进入L3-Switch交换机的配置界面，键入命令：
![](/assets/images/211121_2.jpg)
```
en  
conf t  
no aaa new-model  	
no ip domain-lookup  
ip routing  
no spanning-tree vlan 1  
int f 0/1  
no switchport  	
no sh	 
ip addr 192.168.1.253 255.255.255.0  
exit  
int f 0/2  
no switchport	 
no sh	 
ip addr 192.168.2.253 255.255.255.0  
exit  
router rip  
 version 2  
 timers basic 1 180 0 240  
 network 192.168.1.0  
 network 192.168.2.0  
end  
wr  
```

在L2-Switch1交换机上的两台电脑内设置上述192.168.1.253的默认网关，在L2-Switch2交换机上的电脑内设置192.168.2.253的默认网关，就能够实现跨网络的计算机互相访问。
![](/assets/images/211121_3.jpg)